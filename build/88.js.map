{"version":3,"sources":["../../src/addon/mod/data/pages/search/search.module.ts","../../src/addon/mod/data/pages/search/search.ts"],"names":[],"mappings":"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","file":"88.js","sourcesContent":["// (C) Copyright 2015 Martin Dougiamas\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { CoreDirectivesModule } from '@directives/directives.module';\nimport { AddonModDataComponentsModule } from '../../components/components.module';\nimport { AddonModDataSearchPage } from './search';\nimport { CoreCompileHtmlComponentModule } from '@core/compile/components/compile-html/compile-html.module';\n\n@NgModule({\n    declarations: [\n        AddonModDataSearchPage,\n    ],\n    imports: [\n        CoreDirectivesModule,\n        AddonModDataComponentsModule,\n        CoreCompileHtmlComponentModule,\n        IonicPageModule.forChild(AddonModDataSearchPage),\n        TranslateModule.forChild()\n    ],\n})\nexport class AddonModDataSearchPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/data/pages/search/search.module.ts","// (C) Copyright 2015 Martin Dougiamas\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component } from '@angular/core';\nimport { IonicPage, NavParams, ViewController } from 'ionic-angular';\nimport { FormBuilder, FormGroup } from '@angular/forms';\nimport { CoreUtilsProvider } from '@providers/utils/utils';\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\nimport { CoreTextUtilsProvider } from '@providers/utils/text';\nimport { AddonModDataComponentsModule } from '../../components/components.module';\nimport { AddonModDataFieldsDelegate } from '../../providers/fields-delegate';\n\n/**\n * Page that displays the search modal.\n */\n@IonicPage({ segment: 'addon-mod-data-search' })\n@Component({\n    selector: 'page-addon-mod-data-search',\n    templateUrl: 'search.html',\n})\nexport class AddonModDataSearchPage {\n    search: any;\n    fields: any;\n    data: any;\n    advancedSearch: any;\n    extraImports = [AddonModDataComponentsModule];\n    searchForm: FormGroup;\n    jsData: any;\n    fieldsArray: any;\n\n    constructor(params: NavParams, private viewCtrl: ViewController, fb: FormBuilder, protected utils: CoreUtilsProvider,\n            protected domUtils: CoreDomUtilsProvider, protected fieldsDelegate: AddonModDataFieldsDelegate,\n            protected textUtils: CoreTextUtilsProvider) {\n        this.search = params.get('search');\n        this.fields = params.get('fields');\n        this.data = params.get('data');\n\n        const advanced = {};\n        if (typeof this.search.advanced == 'object') {\n            Object.keys(this.search.advanced).forEach((index) => {\n                if (typeof this.search.advanced[index] != 'undefined' && typeof this.search.advanced[index].name != 'undefined') {\n                    advanced[this.search.advanced[index].name] = this.search.advanced[index].value ?\n                        this.textUtils.parseJSON(this.search.advanced[index].value) : '';\n                } else {\n                    advanced[index] = this.search.advanced[index] ?\n                        this.textUtils.parseJSON(this.search.advanced[index]) : '';\n                }\n            });\n        } else {\n            this.search.advanced.forEach((field) => {\n                advanced[field.name] = field.value ? this.textUtils.parseJSON(field.value) : '';\n            });\n        }\n        this.search.advanced = advanced;\n\n        this.searchForm = fb.group({\n            text: [this.search.text],\n            sortBy: [this.search.sortBy || '0'],\n            sortDirection: [this.search.sortDirection || 'DESC'],\n            firstname: [this.search.advanced['firstname'] || ''],\n            lastname: [this.search.advanced['lastname'] || '']\n        });\n\n        this.fieldsArray = this.utils.objectToArray(this.fields);\n        this.advancedSearch = this.renderAdvancedSearchFields();\n    }\n\n    /**\n     * Displays Advanced Search Fields.\n     *\n     * @return {string}         Generated HTML.\n     */\n    protected renderAdvancedSearchFields(): string {\n        if (!this.data.asearchtemplate) {\n            return '';\n        }\n\n        this.jsData = {\n            fields: this.fields,\n            form: this.searchForm,\n            search: this.search.advanced\n        };\n\n        let template = this.data.asearchtemplate,\n            replace, render;\n\n        // Replace the fields found on template.\n        this.fieldsArray.forEach((field) => {\n            replace = '[[' + field.name + ']]';\n            replace = replace.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\n            replace = new RegExp(replace, 'gi');\n\n            // Replace field by a generic directive.\n            render = '<addon-mod-data-field-plugin mode=\"search\" [field]=\"fields[' + field.id +\n                ']\" [form]=\"form\" [search]=\"search\"></addon-mod-data-field-plugin>';\n            template = template.replace(replace, render);\n        });\n\n        // Not pluginable other search elements.\n        // Replace firstname field by the text input.\n        replace = new RegExp('##firstname##', 'gi');\n        render = '<span [formGroup]=\"form\"><ion-input type=\"text\" name=\"firstname\" \\\n        [placeholder]=\"\\'addon.mod_data.authorfirstname\\' | translate\" formControlName=\"firstname\"></ion-input></span>';\n        template = template.replace(replace, render);\n\n        // Replace lastname field by the text input.\n        replace = new RegExp('##lastname##', 'gi');\n        render = '<span [formGroup]=\"form\"><ion-input type=\"text\" name=\"lastname\" \\\n        [placeholder]=\"\\'addon.mod_data.authorlastname\\' | translate\" formControlName=\"lastname\"></ion-input></span>';\n        template = template.replace(replace, render);\n\n        return template;\n    }\n\n    /**\n     * Retrieve the entered data in search in a form.\n     *\n     * @param {any} searchedData Array with the entered form values.\n     * @return {any[]}          Array with the answers.\n     */\n    getSearchDataFromForm(searchedData: any): any[] {\n        const advancedSearch = [];\n\n        // Filter and translate fields to each field plugin.\n        this.fieldsArray.forEach((field) => {\n            const fieldData = this.fieldsDelegate.getFieldSearchData(field, searchedData);\n\n            if (fieldData) {\n                fieldData.forEach((data) => {\n                    data.value = JSON.stringify(data.value);\n                    // WS wants values in Json format.\n                    advancedSearch.push(data);\n                });\n            }\n        });\n\n        // Not pluginable other search elements.\n        if (searchedData['firstname']) {\n            // WS wants values in Json format.\n            advancedSearch.push({\n                name: 'firstname',\n                value: JSON.stringify(searchedData['firstname'])\n            });\n        }\n\n        if (searchedData['lastname']) {\n            // WS wants values in Json format.\n            advancedSearch.push({\n                name: 'lastname',\n                value: JSON.stringify(searchedData['lastname'])\n            });\n        }\n\n        return advancedSearch;\n    }\n\n    /**\n     * Close modal.\n     *\n     * @param {any} [data] Data to return to the page.\n     */\n    closeModal(data?: any): void {\n        this.viewCtrl.dismiss(data);\n    }\n\n    /**\n     * Toggles between advanced to normal search.\n     */\n    toggleAdvanced(): void {\n        this.search.searchingAdvanced = !this.search.searchingAdvanced;\n    }\n\n    /**\n     * Done editing.\n     */\n    searchEntries(): void {\n        const searchedData = this.searchForm.value;\n\n        if (this.search.searchingAdvanced) {\n            this.search.advanced = this.getSearchDataFromForm(searchedData);\n            this.search.searching = this.search.advanced.length > 0;\n        } else {\n            this.search.text = searchedData.text;\n            this.search.searching = this.search.text.length > 0;\n        }\n\n        this.search.sortBy = searchedData.sortBy;\n        this.search.sortDirection = searchedData.sortDirection;\n\n        this.closeModal(this.search);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/data/pages/search/search.ts"],"sourceRoot":""}